<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viper | Login</title>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #1e293b; padding: 2rem; border-radius: 1rem; width: 320px; border: 1px solid #334155; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #38bdf8; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #toggleBtn { color: #38bdf8; cursor: pointer; text-decoration: underline; font-size: 0.8rem; }
        #status { margin-top: 15px; font-size: 0.85rem; text-align: center; color: #fbbf24; }
    </style>
</head>
<body>
<div class="card">
    <h2 id="title">Login</h2>
    <form id="authForm">
        <input type="text" id="username" placeholder="Choose Username" style="display:none;">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit" id="btn">Login</button>
    </form>
    <p style="margin-top:15px; text-align:center;"><span id="toggleBtn" onclick="toggle()">Need an account? Register</span></p>
    <div id="status"></div>
</div>

<script>
    const BACKEND = "https://database-z8fs.onrender.com";
    let isLogin = true;

    function toggle() {
        isLogin = !isLogin;
        document.getElementById('title').innerText = isLogin ? "Login" : "Register";
        document.getElementById('username').style.display = isLogin ? "none" : "block";
        document.getElementById('username').required = !isLogin;
        document.getElementById('btn').innerText = isLogin ? "Login" : "Create Account";
        document.getElementById('status').innerText = "";
    }

    document.getElementById('authForm').onsubmit = async (e) => {
        e.preventDefault();
        const status = document.getElementById('status');
        status.innerText = "Waking up server... please wait (up to 1 min)";
        
        try {
            const res = await fetch(`${BACKEND}${isLogin ? '/login' : '/register'}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    email: email.value, password: password.value, 
                    username: isLogin ? undefined : username.value 
                })
            });
            const data = await res.json();
            if (data.success) {
                if (isLogin) {
                    localStorage.setItem('vUser', data.username);
                    localStorage.setItem('vPfp', data.pfp || "https://ui-avatars.com" + data.username);
                    window.location.href = "forum.html";
                } else { alert("Registered! Now Login."); toggle(); }
            } else { status.innerText = data.error; status.style.color = "#f87171"; }
        } catch (err) {
            status.innerText = "Server is still starting... try again in 5 seconds.";
        }
    };
</script>
</body>
</html>
